<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Dawkowania WlewÃ³w (v2)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="number"], select {
            width: calc(100% - 22px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .result-box {
            background-color: #e9f7ff;
            border: 1px solid #007bff;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        .result-value {
            font-size: 1.5em;
            color: #007bff;
            font-weight: bold;
        }
        .drug-details {
            margin-top: 15px;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: #f9f9f9;
        }
        .warning {
            color: red;
            font-weight: bold;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid red;
            background-color: #ffeaea;
            border-radius: 4px;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: flex-end;
        }
        .input-group > div {
            flex-grow: 1;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸ’Š Kalkulator Dawkowania WlewÃ³w CiÄ…gÅ‚ych</h2>

    <label for="drug-select">1. Wybierz lek:</label>
    <select id="drug-select" onchange="updateDrugFields()">
        <option value="noradrenaline">Noradrenalina</option>
        <option value="adrenaline">Adrenalina</option>
    </select>

    <hr style="margin: 20px 0;">

    <div id="drug-name-display"><h3>Lek: Noradrenalina</h3></div>
    <label for="weight">Waga Pacjenta (kg):</label>
    <input type="number" id="weight" min="1" value="70" oninput="calculateDose()">

    <label for="indication">Wskazanie:</label>
    <select id="indication" onchange="updatePurpose(this.value, document.getElementById('drug-select').value)">
        </select>
    <div class="drug-details">
        <label>Cel Terapii:</label>
        <p id="purpose-display" style="margin-top: 5px;">ZwiÄ™kszenie oporu naczyniowego, podniesienie ciÅ›nienia</p>
    </div>

    <hr style="margin: 20px 0;">

    <h3>3. Instrukcja Przygotowania Roztworu</h3>

    <div class="input-group">
        <div>
            <label for="syringe-volume">PojemnoÅ›Ä‡ strzykawki (ml):</label>
            <select id="syringe-volume" onchange="calculateConcentration()">
                <option value="50">50 ml</option>
                <option value="20">20 ml</option>
                <option value="10">10 ml</option>
            </select>
        </div>
        <div>
            <label for="ampoules-count">Liczba ampuÅ‚ek (1mg/ml):</label>
            <input type="number" id="ampoules-count" min="1" value="4" oninput="calculateConcentration()">
            <small id="ampoule-info">1 ampuÅ‚ka = 1 mg</small>
        </div>
    </div>
    
    <div class="drug-details" style="margin-top: 10px;">
        <p>
            **Instrukcja dla pompy:** DodaÄ‡ **<span id="drug-total-mg">4</span> mg** leku (z ampuÅ‚ek) do strzykawki o pojemnoÅ›ci <span id="volume-display">50</span> ml. DopeÅ‚niÄ‡ do peÅ‚nej objÄ™toÅ›ci strzykawki rozcieÅ„czalnikiem.
        </p>
        <p>
            **Obliczone StÄ™Å¼enie Roztworu:** **<span id="concentration-display" class="result-value" style="font-size: 1em; color: #333;">80</span>** $\mu \text{g}/\text{ml}$
        </p>
    </div>
    
    <hr style="margin: 20px 0;">

    <h3>4. Obliczanie Dawki i PrzepÅ‚ywu</h3>

    <label for="dose-per-kg-per-min">Dawka docelowa ($\mu$g/kg/min):</label>
    <input type="number" id="dose-per-kg-per-min" min="0.05" max="1.0" step="0.01" value="0.1" oninput="calculateDose()">
    <small>Zakres: <span id="dose-range">0.05 - 1 Âµg/kg/min</span></small>

    <hr style="margin: 20px 0;">

    <h3>ðŸš€ Wyniki ObliczeÅ„ (PrzepÅ‚yw na Pompie):</h3>
    <div class="result-box">
        <p>Wymagana Dawka CaÅ‚kowita:</p>
        <div class="result-value"><span id="total-dose">0.4</span> Âµg/min</div>
    </div>
    <div class="result-box" style="margin-top: 10px;">
        <p>PrzepÅ‚yw na Pompie (ml/h):</p>
        <div class="result-value"><span id="flow-rate">0.3</span> ml/h</div>
    </div>

    <div class="warning">
        <p id="notes-display">
            **Noradrenalina:** DawkÄ™ dostosowaÄ‡ indywidualnie do efektu klinicznego. Monitoruj ciÅ›nienie.
        </p>
    </div>

</div>

<script>
    const drugData = {
        noradrenaline: {
            name: "Noradrenalina",
            ampoule_mg_per_ml: 1,
            indications: [
                { case: "WstrzÄ…s septyczny", purpose: "ZwiÄ™kszenie oporu naczyniowego, podniesienie ciÅ›nienia", dose_min: 0.05, dose_max: 1 },
                { case: "WstrzÄ…s hipowolemiczny (oporny)", purpose: "Podniesienie ciÅ›nienia po wyrÃ³wnaniu objÄ™toÅ›ci", dose_min: 0.05, dose_max: 1 },
                { case: "WstrzÄ…s kardiogenny", purpose: "ZwiÄ™kszenie ciÅ›nienia, wzrost oporu naczyniowego", dose_min: 0.05, dose_max: 1 }
            ],
            notes: "DawkÄ™ dostosowaÄ‡ indywidualnie do efektu klinicznego. Monitoruj ciÅ›nienie.",
            default_ampoules: 4, // 4 mg w 50 ml dla Noradrenaliny (wg. pierwotnej instrukcji)
            default_dose: 0.1 // Âµg/kg/min
        },
        adrenaline: {
            name: "Adrenalina",
            ampoule_mg_per_ml: 1,
            indications: [
                { case: "WstrzÄ…s kardiogenny z bradykardiÄ…", purpose: "Wzrost kurczliwoÅ›ci i czÄ™stoÅ›ci rytmu serca", dose_min: 0.01, dose_max: 0.5 },
                { case: "Bradykardia (Wlew CiÄ…gÅ‚y)", purpose: "ZwiÄ™kszenie czÄ™stoÅ›ci rytmu serca", dose_min: 0.01, dose_max: 0.5 }
            ],
            notes: "Dawkowanie zaleÅ¼y od wskazaÅ„ i masy ciaÅ‚a. Monitoruj parametry Å¼yciowe. **UWAGA: To sÄ… dawki dla wlewu ciÄ…gÅ‚ego, nie dla bolusÃ³w!**",
            default_ampoules: 3, // 3 mg w 50 ml dla Adrenaliny (wg. pierwotnej instrukcji)
            default_dose: 0.05 // Âµg/kg/min
        }
    };

    // Elementy interfejsu
    const drugSelect = document.getElementById('drug-select');
    const weightInput = document.getElementById('weight');
    const indicationSelect = document.getElementById('indication');
    const doseInput = document.getElementById('dose-per-kg-per-min');
    const syringeVolumeSelect = document.getElementById('syringe-volume');
    const ampoulesCountInput = document.getElementById('ampoules-count');
    
    const purposeDisplay = document.getElementById('purpose-display');
    const doseRangeDisplay = document.getElementById('dose-range');
    const totalDoseDisplay = document.getElementById('total-dose');
    const flowRateDisplay = document.getElementById('flow-rate');
    const drugNameDisplay = document.getElementById('drug-name-display');
    const concentrationDisplay = document.getElementById('concentration-display');
    const notesDisplay = document.getElementById('notes-display');
    const drugTotalMgDisplay = document.getElementById('drug-total-mg');
    const volumeDisplay = document.getElementById('volume-display');

    let currentConcentration_ug_per_ml = 0; // Globalne stÄ™Å¼enie w Âµg/ml

    // Funkcja aktualizujÄ…ca stÄ™Å¼enie roztworu
    function calculateConcentration() {
        const drugKey = drugSelect.value;
        const drug = drugData[drugKey];
        const volumeMl = parseFloat(syringeVolumeSelect.value);
        const ampoulesCount = parseInt(ampoulesCountInput.value);

        if (isNaN(volumeMl) || isNaN(ampoulesCount) || volumeMl <= 0 || ampoulesCount <= 0) {
            concentrationDisplay.textContent = 'Brak danych';
            return;
        }

        // CaÅ‚kowita masa leku w roztworze (mg)
        const totalDrugMg = ampoulesCount * drug.ampoule_mg_per_ml;
        
        // CaÅ‚kowita masa leku w roztworze (Âµg)
        const totalDrugUg = totalDrugMg * 1000;

        // Obliczenie stÄ™Å¼enia w Âµg/ml
        currentConcentration_ug_per_ml = totalDrugUg / volumeMl;

        // Aktualizacja wyÅ›wietlania instrukcji
        drugTotalMgDisplay.textContent = totalDrugMg;
        volumeDisplay.textContent = volumeMl;
        concentrationDisplay.textContent = currentConcentration_ug_per_ml.toFixed(2);
        
        // Ponowne przeliczenie dawki po zmianie stÄ™Å¼enia
        calculateDose();
    }

    // Funkcja aktualizujÄ…ca pola po zmianie leku
    function updateDrugFields() {
        const selectedDrugKey = drugSelect.value;
        const drug = drugData[selectedDrugKey];
        
        // 1. Nazwa i notatki
        drugNameDisplay.innerHTML = `<h3>Lek: ${drug.name}</h3>`;
        notesDisplay.innerHTML = `**${drug.name}:** ${drug.notes}`;
        ampoulesCountInput.value = drug.default_ampoules; // Ustaw domyÅ›lnÄ… liczbÄ™ ampuÅ‚ek

        // 2. Lista wskazaÅ„
        indicationSelect.innerHTML = '';
        drug.indications.forEach((ind, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = ind.case;
            indicationSelect.appendChild(option);
        });

        // 3. Zakres dawkowania
        const firstIndication = drug.indications[0];
        doseRangeDisplay.textContent = `${firstIndication.dose_min} - ${firstIndication.dose_max} Âµg/kg/min`;
        doseInput.min = firstIndication.dose_min;
        doseInput.max = firstIndication.dose_max;
        doseInput.value = drug.default_dose;
        doseInput.step = 0.01; // Ustawienie kroku dla wygody

        // 4. Cel i obliczenia
        updatePurpose(0, selectedDrugKey);
        calculateConcentration(); // Oblicz stÄ™Å¼enie na podstawie domyÅ›lnej liczby ampuÅ‚ek
    }

    // Funkcja aktualizujÄ…ca cel po zmianie wskazania
    function updatePurpose(index, drugKey) {
        const drug = drugData[drugKey];
        const indication = drug.indications[index];
        purposeDisplay.textContent = indication.purpose;

        // Aktualizacja zakresu dawkowania dla wybranego wskazania
        doseRangeDisplay.textContent = `${indication.dose_min} - ${indication.dose_max} Âµg/kg/min`;
        doseInput.min = indication.dose_min;
        doseInput.max = indication.dose_max;
        
        // Upewnienie siÄ™, Å¼e aktualna dawka mieÅ›ci siÄ™ w nowym zakresie
        const currentDose = parseFloat(doseInput.value);
        if (currentDose < indication.dose_min || currentDose > indication.dose_max) {
             doseInput.value = drug.default_dose;
        }
        
        calculateDose();
    }

    // GÅ‚Ã³wna funkcja obliczeniowa
    function calculateDose() {
        const weight = parseFloat(weightInput.value);
        const dosePerKgPerMin = parseFloat(doseInput.value);
        const concentration = currentConcentration_ug_per_ml;

        if (isNaN(weight) || weight <= 0 || isNaN(dosePerKgPerMin) || dosePerKgPerMin <= 0 || concentration <= 0) {
            totalDoseDisplay.textContent = 'Brak Danych';
            flowRateDisplay.textContent = 'Brak Danych';
            return;
        }

        // Krok 1: Obliczenie caÅ‚kowitej dawki w Âµg/min
        const totalDoseUgPerMin = dosePerKgPerMin * weight;

        // Krok 2: Obliczenie przepÅ‚ywu w ml/h
        // WzÃ³r: PrzepÅ‚yw (ml/h) = [ Dawka (Âµg/min) * 60 min/h ] / StÄ™Å¼enie (Âµg/ml)
        const flowRateMlPerHour = (totalDoseUgPerMin * 60) / concentration;

        // WyÅ›wietlanie wynikÃ³w
        totalDoseDisplay.textContent = totalDoseUgPerMin.toFixed(2);
        flowRateDisplay.textContent = flowRateMlPerHour.toFixed(2);
    }

    // Inicjalizacja przy Å‚adowaniu strony
    document.addEventListener('DOMContentLoaded', () => {
        updateDrugFields();
    });
</script>

</body>
</html>
